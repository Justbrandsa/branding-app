import { NextRequest, NextResponse } from "next/server"; import { getAdminClient } from "@/lib/shopify"; const STAGED_UPLOADS=`mutation stagedUploadsCreate($input:[StagedUploadInput!]!){ stagedUploadsCreate(input:$input){ stagedTargets{ url resourceUrl parameters{name value} } userErrors{ field message } } }`; export async function POST(req:NextRequest){ try{ const { filename, mimeType } = await req.json(); const admin=getAdminClient(); const stage=await admin.gql(STAGED_UPLOADS,{ input:[{ filename, mimeType, resource:"FILE"}]}); const target=stage.stagedUploadsCreate.stagedTargets[0]; return NextResponse.json({ target }); }catch(e:any){ return NextResponse.json({ error:e.message }, { status:500 }); } }