import { NextRequest, NextResponse } from "next/server"; import { getPriceQuote } from "@/lib/pricing"; import { groupKey, hashPositions } from "@/lib/util"; export async function POST(req: NextRequest){ try{ const body=await req.json(); const { productId, variantId, qty, method, attributes={}, artworkHashes=[], positions=[] } = body; if(!productId||!variantId||!qty||!method) return NextResponse.json({error:"Invalid input"},{status:400}); const quote=await getPriceQuote({ productId, variantId, qty, method, attributes, positions }); const artHash=artworkHashes[0]||"noart"; const gk=groupKey({productGid:productId,method,positionsHash:hashPositions(positions),artworkHash:artHash}); return NextResponse.json({ ...quote, groupKey: gk }); }catch(e:any){ return NextResponse.json({error:e.message},{status:500}); } }